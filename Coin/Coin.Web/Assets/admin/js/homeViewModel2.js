function carouselEntry(n,t){var i=this;i.carouselType=ko.observable(t);i.imgPath=ko.observable("");i.marketPath=ko.observable("");i.marketCurrency=ko.observable("");i.marketCurrencyName=ko.observable("");i.displayBaseVolume=ko.observable("0.00000000");i.baseCurrency=ko.observable("");i.displayChange=ko.observable(0);i.marketName=ko.observable("");i.ticks=[];i.update=function(n){i.imgPath(n.imgPath);i.marketPath(n.urlPath);i.marketCurrency(n.marketCurrency);i.marketCurrencyName(n.marketCurrencyName);i.displayBaseVolume(n.displayBaseVolume());i.baseCurrency(n.baseCurrency);i.displayChange(n.displayChange());i.marketName(n.marketName);$("#event-store").trigger({type:"request-query-tickex",serviceData:{marketName:i.marketName(),tickInterval:"hour"}})};i.clickEntry=function(){window.open(i.marketPath(),"_blank")};i.update(n)}function marketCarousel(n,t){var i=this,r,u,f;i.summaries=ko.observableArray([]).indexed("marketName");i.markets=ko.observableArray([]);i.marketName="base-market";i.currentSummary=ko.observable(null);i.crowdfundSummary=ko.observable(null);i.isSetCurrentSummary=ko.pureComputed(function(){return i.currentSummary()},this);r=function(n){var t=n.serviceData,r=$.map(t,function(n){if(n.Market.BaseCurrency!="USDT"&&n.Market.BaseCurrency!="ETH"&&n.Market.BaseCurrency!="BITCNY"&&n.Market.BaseCurrency!="UBQ")return new marketSummaryEntry(n)});i.summaries(r);i.updateCarousel()};$("#event-store").one("data-query-summaries",r);i.updateCarousel=function(){function v(){jQuery.ajax({url:"/crowdfund/GetApxStats",dataType:"json",cache:!1,success:function(n){i.apxEntry.displayBaseVolume(n.BTC.toFixed(2))},error:function(){console.log("Error loading average volume ...")}})}var n=[],u,a=function(n,t){return n[u]()<t[u]()?-1:n[u]()>t[u]()?1:n[u]()==t[u]()?0:0},c=function(n,t){return a(t,n)},f,s,e,h,l,r,o;if(u="baseVolume",f=i.summaries().sort(c),f&&f.length>0&&(s=f[0],n.push(new carouselEntry(s,"Top Volume"))),f&&f.length>1&&(s=f[1],n.push(new carouselEntry(s,"Top Volume"))),u="change",e=i.summaries().sort(c),e&&e.length>0)for(h=0,r=0;r<e.length;r++)if(o=e[r],o.baseVolume()>"5"&&(l=e[r],n.push(new carouselEntry(l,"Biggest % Gain")),h++,h>=2))break;for(r=0;r<i.summaries().length;r++)o=i.summaries()[r],o.isSponsored()&&n.push(new carouselEntry(o,"Sponsored"));n=_.uniq(n,!1,function(n){return n.marketName()});n=_.sample(n,n.length);i.markets(n);$("."+t).jcarousel("reload");$("."+t).jcarouselAutoscroll("start");v()};u=function(n){var r,u,t;for(i.currentSummary(null),r=0;r<i.summaries().length;r++)t=i.summaries()[r],t.marketName==n&&i.currentSummary(t);for(u=0;u<i.markets().length;u++)t=i.markets()[u],t.marketName()==n&&t.isCFC&&i.crowdfundSummary(t)};f=function(n){var t=$("."+n).jcarousel({wrap:"circular"});$("."+n).jcarouselAutoscroll({interval:1e4,target:"+=1",autostart:!0});$("."+n).on("jcarousel:targetin","li",function(){var n=$(".item .marketName",this).text();console.log(n);u(n)})};f(t)}function marketSummaryTables(){"use strict";var n=this,t,i;n.summaries=ko.observableArray([]).indexed("marketName").extend({rateLimit:1e3});n.btcTable=new marketSummaryKoTable(n.summaries,{title:"Bitcoin",icon:"visible-xs cc BTC",baseCurrency:"BTC",defaultSort:"marketVolume"});n.ethTable=new marketSummaryKoTable(n.summaries,{title:"Ethereum",icon:"visible-xs cc ETH",baseCurrency:"ETH",defaultSort:"marketVolume"});n.fiatTable=new marketSummaryKoTable(n.summaries,{title:"USDT / BITCNY",icon:"visible-xs cc USDT",fiatOnly:!0,defaultSort:"marketVolume"});t=function(t){for(var u,r=t.serviceData.Deltas,i=0;i<r.length;i++)r[i].marketName=r[i].MarketName,n.summaries.contains(r[i])&&(u=n.summaries.index()[r[i].MarketName],n.summaries()[u].updateSummary(r[i]));n.summaries.valueHasMutated()};i=function(t){var i=t.serviceData,r=$.map(i,function(n){var t=new marketSummaryEntry(n);return t.isActive()||(t.marketVolume(0),t.baseVolume(0)),t});n.summaries(r)};$("#event-store").on("data-update-summaries",t);$("#event-store").one("data-query-summaries",i);n.resize=function(t){n.btcTable.resize(t);n.ethTable.resize(t);n.fiatTable.resize(t)}}function marketSummaryKoTable(n,t){"use strict";var i=this,r,u;i.descending="fa fa-arrow-down";i.ascending="fa fa-arrow-up";i.title=ko.observable(t.title);i.icon=ko.observable(t.icon);i.summaries=n;i.columns=ko.observableArray([{property:"marketName",header:"Market",headerClass:"col-header",type:"string",state:ko.observable(""),isObservable:!1},{property:"marketCurrencyName",header:"Currency",headerClass:"col-header visible-lg",type:"string",state:ko.observable(""),isObservable:!1},{property:"baseVolume",header:"Volume",headerClass:"col-header",type:"number",state:ko.observable(i.descending),isObservable:!0},{property:"change",header:"% Change",headerClass:"col-header",type:"percent",state:ko.observable(""),isObservable:!0},{property:"last",header:"Last Price",headerClass:"col-header",type:"number",state:ko.observable(""),isObservable:!0},{property:"high",header:"24Hr High",headerClass:"col-header visible-lg visible-md",type:"number",state:ko.observable(""),isObservable:!0},{property:"low",header:"24Hr Low",headerClass:"col-header visible-lg visible-md",type:"number",state:ko.observable(""),isObservable:!0},{property:"spread",header:"% Spread",headerClass:"col-header visible-lg",type:"percent",state:ko.observable(""),isObservable:!0},{property:"created",header:"Added",headerClass:"col-header visible-lg",type:"date",state:ko.observable(""),isObservable:!0}]);i.selectedSort=ko.observable(i.columns()[2]);i.filter=ko.observable("");i.filteredSummaries=ko.pureComputed(function(){return $.map(i.summaries(),function(n){return t.baseCurrency&&n.marketName.lastIndexOf(t.baseCurrency,0)!==0?null:t.fiatOnly&&!n.isFiat()?null:i.filter&&i.filter()?n.keywords.toLowerCase().indexOf(i.filter().toLowerCase())>-1||n.keywords.toLowerCase().indexOf(i.filter().toLowerCase())>-1?n:null:n})});i.visibleSummaries=ko.pureComputed(function(){var r=i.filteredSummaries(),n,e,t,o,s,f;return i.selectedSort&&i.selectedSort()&&(n=i.selectedSort().property,e=i.selectedSort().state()==i.ascending,t=i.selectedSort().isObservable?function(t,i){return t[n]()<i[n]()?-1:t[n]()>i[n]()?1:t[n]()==i[n]()?0:0}:function(t,i){return t[n]<i[n]?-1:t[n]>i[n]?1:t[n]==i[n]?0:0},o=function(n,i){return t(i,n)},n=="created"&&(t=function(n,t){return n.created().isBefore(t.created())?-1:n.created().isAfter(t.created())?1:n.created().isSame(t.created())?0:0}),s=e?t:o,r=r.sort(s)),f=i.pageIndex()*u,r.slice(f,f+u)});i.sortClick=function(n){try{i.clearColumnStates(n);n.state()===""||n.state()===i.descending?n.state(i.ascending):n.state(i.descending);i.selectedSort(n)}catch(t){}};i.clearColumnStates=function(n){for(var r=i.columns().filter(function(t){return t!=n}),t=0;t<r.length;t++)r[t].state("")};r=4;u=20;i.pageIndex=ko.observable(0);i.maxPageIndex=ko.pureComputed(function(){return Math.ceil(i.filteredSummaries().length/u)-1});i.previousPage=function(){i.pageIndex()>0&&i.pageIndex(i.pageIndex()-1)};i.firstPage=function(){i.pageIndex()>0&&i.pageIndex(0)};i.nextPage=function(){i.pageIndex()<i.maxPageIndex()&&i.pageIndex(i.pageIndex()+1)};i.lastPage=function(){i.pageIndex()<i.maxPageIndex()&&i.pageIndex(i.maxPageIndex())};i.allPages=ko.pureComputed(function(){var f=[],t=0,u=i.maxPageIndex(),n;for(i.pageIndex()<Math.floor(r/2)?u=r:i.pageIndex()>i.maxPageIndex()-r?t=i.maxPageIndex()-r:(t=i.pageIndex()-Math.floor(r/2),u=i.pageIndex()+Math.ceil(r/2)),n=t;n<=u;n++)f.push({pageNumber:n+1});return f});i.moveToPage=function(n){i.pageIndex(n)};i.resize=function(n){n=="xs"&&(i.pageSize=10)}}function homeViewModel(){"use strict";var n=this;n.tables=new marketSummaryTables;n.carousel=new marketCarousel("divTickChart","carousel-navigation");n.resize=function(t){n.tables.resize(t)}}$(function(){"use strict";function t(){screen_xs_size()?n.resize("xs"):screen_sm_size()?n.resize("sm"):screen_md_size()?n.resize("md"):screen_lg_size()&&n.resize("lg")}var n=new homeViewModel,i;document.getElementById("home-wrapper")!=null&&ko.applyBindings(n,document.getElementById("home-wrapper"));i=_.debounce(t,500);window.addEventListener("resize",i,!1);$(window).load(t)})